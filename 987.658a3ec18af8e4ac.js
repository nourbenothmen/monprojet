"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[987],{987:(C,_,r)=>{r.r(_),r.d(_,{ReglementTableComponent:()=>T});var d=r(6396),l=r(9417),h=r(7468),g=r(5727),u=r(3964),p=r(3413),e=r(7241),m=r(8564),v=r(2529),f=r(676),E=r(1838),R=r(3525);const F=(o,a)=>a.id;function D(o,a){if(1&o&&(e.j41(0,"option",12),e.EFF(1),e.k0s()),2&o){const t=a.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function b(o,a){1&o&&(e.j41(0,"div",13)(1,"div",14)(2,"span",15),e.EFF(3,"Chargement..."),e.k0s()(),e.j41(4,"p"),e.EFF(5,"Chargement des donn\xe9es..."),e.k0s()())}function I(o,a){if(1&o){const t=e.RV6();e.j41(0,"tr")(1,"th",18),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.nI1(5,"currency"),e.k0s(),e.j41(6,"td"),e.EFF(7),e.nI1(8,"date"),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.j41(11,"td"),e.EFF(12),e.k0s(),e.j41(13,"td"),e.EFF(14),e.k0s(),e.j41(15,"td")(16,"button",19),e.bIt("click",function(){const s=m.eBV(t).$implicit,i=e.XpG(2);return m.Njj(i.openEditModal(s))}),e.nrm(17,"i",20),e.k0s(),e.j41(18,"button",21),e.bIt("click",function(){const s=m.eBV(t).$implicit,i=e.XpG(2);return m.Njj(i.confirmDelete(s.id))}),e.nrm(19,"i",22),e.k0s()()()}if(2&o){const t=a.$implicit,n=e.XpG(2);e.R7$(2),e.JRh(t.id),e.R7$(2),e.JRh(e.i5U(5,6,t.montant,n.getDeviseSymbol(t.deviseId))),e.R7$(3),e.JRh(e.i5U(8,9,t.dateReglement,"dd/MM/yyyy HH:mm")),e.R7$(3),e.JRh(n.getFactureInfo(t.factureId)),e.R7$(2),e.JRh(t.modePaiement),e.R7$(2),e.JRh(n.getDeviseSymbol(t.deviseId))}}function M(o,a){1&o&&(e.j41(0,"tr")(1,"td",23),e.EFF(2,"Aucun r\xe8glement trouv\xe9"),e.k0s()())}function P(o,a){if(1&o&&(e.j41(0,"div",16)(1,"table",17)(2,"thead")(3,"tr")(4,"th"),e.EFF(5,"Id"),e.k0s(),e.j41(6,"th"),e.EFF(7,"Montant"),e.k0s(),e.j41(8,"th"),e.EFF(9,"Date"),e.k0s(),e.j41(10,"th"),e.EFF(11,"Facture"),e.k0s(),e.j41(12,"th"),e.EFF(13,"Mode de Paiement"),e.k0s(),e.j41(14,"th"),e.EFF(15,"Devise"),e.k0s(),e.j41(16,"th"),e.EFF(17,"Actions"),e.k0s()()(),e.j41(18,"tbody"),e.Z7z(19,I,20,12,"tr",null,F),e.nVh(21,M,3,0,"tr"),e.k0s()()()),2&o){const t=e.XpG();e.R7$(19),e.Dyx(t.filteredReglements),e.R7$(2),e.vxM(0===t.filteredReglements.length?21:-1)}}let T=(()=>{class o{constructor(t,n,s,i){this.reglementService=t,this.factureService=n,this.deviseService=s,this.modalService=i,this.reglements=[],this.filteredReglements=[],this.factures=[],this.devises=[],this.modePaiementOptions=Object.values(g.j),this.modePaiementFilter="",this.isDataLoaded=!1}ngOnInit(){this.loadData()}loadData(){(0,h.p)({reglements:this.reglementService.getAllReglements(),factures:this.factureService.getAllFactures(),devises:this.deviseService.getAllDevises()}).subscribe({next:({reglements:t,factures:n,devises:s})=>{this.reglements=t,this.filteredReglements=t,this.factures=n.map(i=>({...i,resteAPayer:i.resteAPayer??i.total??0})),this.devises=s,this.isDataLoaded=!0,console.log("R\xe8glements charg\xe9s:",t),console.log("Factures charg\xe9es (avec resteAPayer):",this.factures),console.log("Devises charg\xe9es:",s)},error:t=>{console.error("Erreur lors du chargement des donn\xe9es:",t),this.isDataLoaded=!0}})}filterByModePaiement(){this.filteredReglements=this.modePaiementFilter?this.reglements.filter(t=>t.modePaiement===this.modePaiementFilter):[...this.reglements]}openAddModal(){if(!this.isDataLoaded)return void console.warn("Donn\xe9es non charg\xe9es, impossible d'ouvrir la modale");const t=this.modalService.open(u.r,{size:"lg"});t.componentInstance.reglement={montant:0,dateReglement:(new Date).toISOString(),factureId:0,modePaiement:g.j.CASH,deviseId:0},t.componentInstance.factures=[...this.factures],t.componentInstance.devises=[...this.devises],t.componentInstance.isEdit=!1,t.result.then(n=>{n&&this.reglementService.createReglement(n).subscribe({next:()=>this.loadData(),error:s=>console.error("Erreur cr\xe9ation de r\xe8glement:",s)})}).catch(()=>{})}openEditModal(t){if(!this.isDataLoaded)return void console.warn("Donn\xe9es non charg\xe9es, impossible d'ouvrir la modale");const n=this.modalService.open(u.r,{size:"lg"}),s={...t};n.componentInstance.reglement=s,n.componentInstance.factures=[...this.factures],n.componentInstance.devises=[...this.devises],n.componentInstance.isEdit=!0,n.result.then(i=>{i&&i.id&&this.reglementService.updateReglement(i.id,i).subscribe({next:()=>this.loadData(),error:c=>console.error("Erreur mise \xe0 jour de r\xe8glement:",c)})}).catch(()=>{})}confirmDelete(t){confirm("\xcates-vous s\xfbr de vouloir supprimer ce r\xe8glement ?")&&this.reglementService.deleteReglement(t).subscribe({next:()=>this.loadData(),error:n=>console.error("Erreur lors de la suppression:",n)})}getFactureInfo(t){const n=this.factures.find(s=>s.id===t);return n?`${n.id} - ${n.client?.name||"Client inconnu"}`:"Facture inconnue"}getDeviseSymbol(t){const n=this.devises.find(s=>s.id===t);return n?n.symbole:"TND"}static{this.\u0275fac=function(n){return new(n||o)(e.rXU(v.r),e.rXU(f.Q),e.rXU(E.c),e.rXU(R.Bq))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-reglement-table"]],decls:14,vars:6,consts:[[1,"row"],[1,"col-xl-12"],["cardTitle","Liste des R\xe8glements","blockClass","table-border-style",3,"options"],[1,"mb-3"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fa","fa-plus"],[1,"float-end"],[1,"form-select",2,"width","220px","display","inline-block",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],["class","table-responsive",4,"ngIf"],[3,"value"],[1,"text-center"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"table-responsive"],[1,"table","table-striped"],["scope","row"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"fa","fa-edit"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"fa","fa-trash"],["colspan","7",1,"text-center"]],template:function(n,s){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"app-card",2)(3,"div",3)(4,"button",4),e.bIt("click",function(){return s.openAddModal()}),e.nrm(5,"i",5),e.EFF(6," Ajouter un r\xe8glement "),e.k0s(),e.j41(7,"div",6)(8,"select",7),e.mxI("ngModelChange",function(c){return e.DH7(s.modePaiementFilter,c)||(s.modePaiementFilter=c),c}),e.bIt("change",function(){return s.filterByModePaiement()}),e.j41(9,"option",8),e.EFF(10,"Tous les modes de paiement"),e.k0s(),e.DNE(11,D,2,2,"option",9),e.k0s()()(),e.DNE(12,b,6,0,"div",10)(13,P,22,1,"div",11),e.k0s()()()),2&n&&(e.R7$(2),e.Y8G("options",!1),e.R7$(2),e.Y8G("disabled",!s.isDataLoaded),e.R7$(4),e.R50("ngModel",s.modePaiementFilter),e.R7$(3),e.Y8G("ngForOf",s.modePaiementOptions),e.R7$(),e.Y8G("ngIf",!s.isDataLoaded),e.R7$(),e.Y8G("ngIf",s.isDataLoaded))},dependencies:[d.MD,d.Sq,d.bT,d.oe,d.vh,l.YN,l.xH,l.y7,l.wz,l.BC,l.vS,p.i],encapsulation:2})}}return o})()}}]);