"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[751],{2751:(U,f,c)=>{c.r(f),c.d(f,{FactureComponent:()=>O});var p=c(6396),d=c(9417),g=c(482),v=c(5727),b=c(3413),e=c(7241),u=c(8564),h=c(3525);function I(s,a){if(1&s&&(e.j41(0,"option",32),e.EFF(1),e.k0s()),2&s){const t=a.$implicit;e.Y8G("value",t.id),e.R7$(),e.Lme(" ",t.name," (",t.email,") ")}}function E(s,a){if(1&s&&(e.j41(0,"option",32),e.EFF(1),e.k0s()),2&s){const t=a.$implicit;e.Y8G("value",t.id),e.R7$(),e.Lme(" ",t.nom," (",t.code,") ")}}function D(s,a){if(1&s&&(e.j41(0,"option",32),e.EFF(1),e.nI1(2,"currency"),e.k0s()),2&s){const t=a.$implicit,i=e.XpG(2);e.Y8G("value",t.id),e.R7$(),e.Lme(" ",t.name," (",e.ii3(2,3,t.price,i.getDeviseSymbol(),"symbol","1.2-2"),") ")}}function y(s,a){if(1&s){const t=e.RV6();e.j41(0,"tr")(1,"td")(2,"select",33),e.mxI("ngModelChange",function(n){const o=u.eBV(t).$implicit;return e.DH7(o.produitID,n)||(o.produitID=n),u.Njj(n)}),e.bIt("change",function(){const n=u.eBV(t).index,o=e.XpG();return u.Njj(o.updateLigne(n))}),e.DNE(3,D,3,8,"option",10),e.k0s()(),e.j41(4,"td")(5,"input",34),e.mxI("ngModelChange",function(n){const o=u.eBV(t).$implicit;return e.DH7(o.quantity,n)||(o.quantity=n),u.Njj(n)}),e.bIt("change",function(){const n=u.eBV(t).index,o=e.XpG();return u.Njj(o.updateLigne(n))}),e.k0s()(),e.j41(6,"td"),e.EFF(7),e.nI1(8,"currency"),e.k0s(),e.j41(9,"td"),e.EFF(10),e.nI1(11,"currency"),e.k0s(),e.j41(12,"td")(13,"button",35),e.bIt("click",function(){const n=u.eBV(t).index,o=e.XpG();return u.Njj(o.removeLigne(n))}),e.nrm(14,"i",36),e.k0s()()()}if(2&s){const t=a.$implicit,i=a.index,n=e.XpG();e.R7$(2),e.Y8G("name",e.VkB("produit_",i)),e.R50("ngModel",t.produitID),e.R7$(),e.Y8G("ngForOf",n.produits),e.R7$(2),e.Y8G("name",e.VkB("quantity_",i)),e.R50("ngModel",t.quantity),e.R7$(2),e.JRh(e.ii3(8,9,n.getProduitPrice(t.produitID),n.getDeviseSymbol(),"symbol","1.2-2")),e.R7$(3),e.JRh(e.ii3(11,14,n.getLigneTotal(t),n.getDeviseSymbol(),"symbol","1.2-2"))}}function C(s,a){if(1&s&&(e.j41(0,"option",32),e.EFF(1),e.nI1(2,"currency"),e.k0s()),2&s){const t=a.$implicit,i=e.XpG();e.Y8G("value",t.id),e.R7$(),e.Lme(" ",t.name," (",e.ii3(2,3,t.price,i.getDeviseSymbol(),"symbol","1.2-2"),") ")}}let F=(()=>{class s{get isDataLoaded(){return this.clients.length>0&&this.produits.length>0&&this.devises.length>0}constructor(t){this.activeModal=t,this.isEdit=!1,this.facture={id:0,dateFacture:new Date,clientID:0,factureLignes:[],status:g.P.NON_REGLE,total:0,resteAPayer:0,deviseId:0},this.clients=[],this.produits=[],this.devises=[],this.newLigne={produitID:0,quantity:1,price:0},console.log("Initialisation du composant"),console.log("Clients disponibles:",this.clients),console.log("Produits des lignes:",this.produits),console.log("Devises disponibles:",this.devises),console.log("Facture initiale re\xe7ue:",{...this.facture})}get formattedDate(){return this.facture.dateFacture?new Date(this.facture.dateFacture).toISOString().split("T")[0]:""}getProduitPrice(t){const i=this.produits.find(n=>n.id===Number(t));return i?i.price:0}getLigneTotal(t){return this.getProduitPrice(t.produitID)*t.quantity}getDeviseSymbol(){const t=this.devises.find(i=>i.id===this.facture.deviseId);return t?t.symbole:"TND"}addLigne(){if(console.log("--- D\xe9but addLigne ---"),console.log("newLigne avant traitement:",this.newLigne),console.log("Liste des produits disponibles:",this.produits),this.newLigne.produitID>0){console.log("ProduitID valide:",this.newLigne.produitID);const t=this.produits.find(i=>i.id===Number(this.newLigne.produitID));if(console.log("Produit trouv\xe9:",t),t){console.log("Prix du produit:",t.price);const i={...this.newLigne,price:t.price};console.log("Nouvelle ligne cr\xe9\xe9e:",i),this.facture.factureLignes.push(i),console.log("Liste des lignes apr\xe8s ajout:",this.facture.factureLignes),this.resetNewLigne(),console.log("newLigne apr\xe8s reset:",this.newLigne)}else console.error("Aucun produit trouv\xe9 avec ID:",this.newLigne.produitID)}else console.warn("ID de produit invalide ou non s\xe9lectionn\xe9");console.log("--- Fin addLigne ---")}removeLigne(t){this.facture.factureLignes.splice(t,1),console.log("Liste des lignes apr\xe8s suppression:",this.facture.factureLignes)}getProduitName(t){const i=this.produits.find(n=>n.id===t);return i||console.warn("Produit non trouv\xe9 pour ID:",t),i?i.name:"Produit inconnu"}calculateTotal(){return this.facture.factureLignes.reduce((t,i)=>t+this.getProduitPrice(i.produitID)*i.quantity,0)}isFormValid(){return this.facture.clientID>0&&null!=this.facture.dateFacture&&this.facture.factureLignes.length>0&&this.facture.deviseId>0}save(){this.isFormValid()?(this.facture.factureLignes.forEach(t=>{const i=this.produits.find(n=>n.id===t.produitID);i&&(t.price=i.price)}),this.facture.total=this.calculateTotal(),this.isEdit?null==this.facture.resteAPayer&&(console.log("Setting resteAPayer for edit case:",this.facture.total),this.facture.resteAPayer=this.facture.total):(console.log("Setting resteAPayer for new facture:",this.facture.total),this.facture.resteAPayer=this.facture.total),console.log("Envoi au serveur:",this.facture),this.activeModal.close(this.facture)):console.warn("Formulaire invalide")}updateLigne(t){const i=this.facture.factureLignes[t];i.quantity<1&&(i.quantity=1);const n=this.produits.find(o=>o.id===i.produitID);n&&(i.price=n.price),console.log("Ligne mise \xe0 jour:",{...i,total:this.getProduitPrice(i.produitID)*i.quantity})}resetNewLigne(){console.log("Reset de newLigne"),this.newLigne={produitID:0,quantity:1,price:0}}onDateChange(t){if(t){const i=t.split("-"),n=new Date(parseInt(i[0],10),parseInt(i[1],10)-1,parseInt(i[2],10));console.log("Date convertie:",n),this.facture.dateFacture=n}}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(h.Lw))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-add-edit-facture-modal"]],inputs:{isEdit:"isEdit",facture:"facture",clients:"clients",produits:"produits",devises:"devises"},decls:70,vars:23,consts:[[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[3,"ngSubmit"],[1,"row","mb-3"],[1,"col-md-6"],[1,"form-label"],["name","clientID","required","",1,"form-select",3,"ngModelChange","ngModel"],["disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],["type","date","name","dateFacture","required","",1,"form-control",3,"ngModelChange","ngModel"],["name","deviseId","required","",1,"form-select",3,"ngModelChange","ngModel"],[1,"mb-3"],[1,"table-responsive"],[1,"table","table-sm"],[4,"ngFor","ngForOf"],[1,"card","mb-3"],[1,"card-header"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-5"],["name","produitID",1,"form-select",3,"ngModelChange","ngModel"],[1,"col-md-2"],["type","number","min","1","name","quantity",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-3"],["type","number","step","0.01","name","price","disabled","",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-primary","w-100",3,"click","disabled"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"mb-0"],["type","button",1,"btn","btn-secondary","me-2",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[3,"value"],[1,"form-select","form-select-sm",3,"ngModelChange","change","ngModel","name"],["type","number","min","1",1,"form-control","form-control-sm",3,"ngModelChange","change","ngModel","name"],["type","button",1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"feather","icon-trash-2"]],template:function(i,n){1&i&&(e.j41(0,"div",0)(1,"h4",1),e.EFF(2),e.k0s(),e.j41(3,"button",2),e.bIt("click",function(){return n.activeModal.dismiss()}),e.k0s()(),e.j41(4,"div",3)(5,"form",4),e.bIt("ngSubmit",function(){return n.save()}),e.j41(6,"div",5)(7,"div",6)(8,"label",7),e.EFF(9,"Client"),e.k0s(),e.j41(10,"select",8),e.mxI("ngModelChange",function(r){return e.DH7(n.facture.clientID,r)||(n.facture.clientID=r),r}),e.j41(11,"option",9),e.EFF(12,"S\xe9lectionnez un client"),e.k0s(),e.DNE(13,I,2,3,"option",10),e.k0s()(),e.j41(14,"div",6)(15,"label",7),e.EFF(16,"Date"),e.k0s(),e.j41(17,"input",11),e.bIt("ngModelChange",function(r){return n.onDateChange(r)}),e.k0s()()(),e.j41(18,"div",5)(19,"div",6)(20,"label",7),e.EFF(21,"Devise"),e.k0s(),e.j41(22,"select",12),e.mxI("ngModelChange",function(r){return e.DH7(n.facture.deviseId,r)||(n.facture.deviseId=r),r}),e.j41(23,"option",9),e.EFF(24,"S\xe9lectionnez une devise"),e.k0s(),e.DNE(25,E,2,3,"option",10),e.k0s()()(),e.j41(26,"div",13)(27,"h5"),e.EFF(28,"Lignes de facture"),e.k0s(),e.j41(29,"div",14)(30,"table",15)(31,"thead")(32,"tr")(33,"th"),e.EFF(34,"Produit"),e.k0s(),e.j41(35,"th"),e.EFF(36,"Quantit\xe9"),e.k0s(),e.j41(37,"th"),e.EFF(38,"Prix unitaire"),e.k0s(),e.j41(39,"th"),e.EFF(40,"Total"),e.k0s(),e.nrm(41,"th"),e.k0s()(),e.j41(42,"tbody"),e.DNE(43,y,15,19,"tr",16),e.k0s()()()(),e.j41(44,"div",17)(45,"div",18),e.EFF(46,"Ajouter une ligne"),e.k0s(),e.j41(47,"div",19)(48,"div",20)(49,"div",21)(50,"select",22),e.mxI("ngModelChange",function(r){return e.DH7(n.newLigne.produitID,r)||(n.newLigne.produitID=r),r}),e.j41(51,"option",9),e.EFF(52,"S\xe9lectionnez un produit"),e.k0s(),e.DNE(53,C,3,8,"option",10),e.k0s()(),e.j41(54,"div",23)(55,"input",24),e.mxI("ngModelChange",function(r){return e.DH7(n.newLigne.quantity,r)||(n.newLigne.quantity=r),r}),e.k0s()(),e.j41(56,"div",25)(57,"input",26),e.mxI("ngModelChange",function(r){return e.DH7(n.newLigne.price,r)||(n.newLigne.price=r),r}),e.k0s()(),e.j41(58,"div",23)(59,"button",27),e.bIt("click",function(){return n.addLigne()}),e.EFF(60," Ajouter "),e.k0s()()()()(),e.j41(61,"div",28)(62,"h5",29),e.EFF(63),e.nI1(64,"currency"),e.k0s(),e.j41(65,"div")(66,"button",30),e.bIt("click",function(){return n.activeModal.dismiss()}),e.EFF(67," Annuler "),e.k0s(),e.j41(68,"button",31),e.EFF(69),e.k0s()()()()()),2&i&&(e.R7$(2),e.SpI("",n.isEdit?"Modifier":"Cr\xe9er"," une facture"),e.R7$(8),e.R50("ngModel",n.facture.clientID),e.R7$(),e.Y8G("value",null),e.R7$(2),e.Y8G("ngForOf",n.clients),e.R7$(4),e.Y8G("ngModel",n.formattedDate),e.R7$(5),e.R50("ngModel",n.facture.deviseId),e.R7$(),e.Y8G("value",null),e.R7$(2),e.Y8G("ngForOf",n.devises),e.R7$(18),e.Y8G("ngForOf",n.facture.factureLignes),e.R7$(7),e.R50("ngModel",n.newLigne.produitID),e.R7$(),e.Y8G("value",null),e.R7$(2),e.Y8G("ngForOf",n.produits),e.R7$(2),e.R50("ngModel",n.newLigne.quantity),e.R7$(2),e.R50("ngModel",n.newLigne.price),e.R7$(2),e.Y8G("disabled",!n.newLigne.produitID),e.R7$(4),e.SpI("Total: ",e.ii3(64,18,n.calculateTotal(),n.getDeviseSymbol(),"symbol","1.2-2")),e.R7$(5),e.Y8G("disabled",!n.isFormValid()),e.R7$(),e.SpI(" ",n.isEdit?"Mettre \xe0 jour":"Cr\xe9er"," "))},dependencies:[p.MD,p.Sq,p.oe,d.YN,d.qT,d.xH,d.y7,d.me,d.Q0,d.wz,d.BC,d.cb,d.YS,d.VZ,d.vS,d.cV],encapsulation:2})}}return s})();var R=c(3964),j=c(7468),M=c(676),k=c(1111),L=c(7689),S=c(1838),T=c(2529);const _=(s,a)=>a.id;function A(s,a){if(1&s&&(e.j41(0,"option",8),e.EFF(1),e.k0s()),2&s){const t=a.$implicit;e.Y8G("value",t.id),e.R7$(),e.SpI(" ",t.name," ")}}function $(s,a){1&s&&(e.j41(0,"div",12)(1,"div",13)(2,"span",14),e.EFF(3,"Chargement..."),e.k0s()(),e.j41(4,"p"),e.EFF(5,"Chargement des donn\xe9es..."),e.k0s()())}function G(s,a){if(1&s&&(e.j41(0,"li"),e.EFF(1),e.nI1(2,"currency"),e.k0s()),2&s){const t=a.$implicit,i=e.XpG().$implicit,n=e.XpG(2);e.R7$(),e.E5c(" ",t.quantity," x ",(null==t.produit?null:t.produit.name)||"Produit supprim\xe9"," (",e.i5U(2,3,t.price,n.getDeviseSymbol(i.deviseId)),") ")}}function P(s,a){1&s&&(e.j41(0,"span",30),e.EFF(1," (Debug: Null/Undefined) "),e.k0s())}function w(s,a){1&s&&(e.j41(0,"span",31),e.EFF(1,"R\xe9gl\xe9e"),e.k0s())}function N(s,a){1&s&&(e.j41(0,"span",32),e.EFF(1,"Non r\xe9gl\xe9e"),e.k0s())}function Y(s,a){if(1&s&&(e.j41(0,"span",33),e.EFF(1),e.k0s()),2&s){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.status," ")}}function X(s,a){if(1&s){const t=e.RV6();e.j41(0,"tr")(1,"th",17),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.nI1(5,"date"),e.k0s(),e.j41(6,"td"),e.EFF(7),e.k0s(),e.j41(8,"td"),e.EFF(9),e.nI1(10,"currency"),e.k0s(),e.j41(11,"td")(12,"ul",18),e.Z7z(13,G,3,6,"li",null,_),e.k0s()(),e.j41(15,"td",19),e.EFF(16),e.nI1(17,"currency"),e.DNE(18,P,2,0,"span",20),e.k0s(),e.j41(19,"td"),e.DNE(20,w,2,0,"span",21)(21,N,2,0,"span",22)(22,Y,2,1,"span",23),e.k0s(),e.j41(23,"td")(24,"button",24),e.bIt("click",function(){const n=u.eBV(t).$implicit,o=e.XpG(2);return u.Njj(o.openEditModal(n))}),e.nrm(25,"i",25),e.k0s(),e.j41(26,"button",26),e.bIt("click",function(){const n=u.eBV(t).$implicit,o=e.XpG(2);return u.Njj(o.openAddReglementModal(n))}),e.nrm(27,"i",27),e.k0s(),e.j41(28,"button",28),e.bIt("click",function(){const n=u.eBV(t).$implicit,o=e.XpG(2);return u.Njj(o.confirmDelete(n.id))}),e.nrm(29,"i",29),e.k0s()()()}if(2&s){const t=a.$implicit,i=e.XpG(2);e.R7$(2),e.JRh(t.id),e.R7$(2),e.JRh(e.i5U(5,10,t.dateFacture,"dd/MM/yyyy")),e.R7$(3),e.JRh((null==t.client?null:t.client.name)||"Client inconnu"),e.R7$(2),e.JRh(e.i5U(10,13,t.total,i.getDeviseSymbol(t.deviseId))),e.R7$(4),e.Dyx(t.factureLignes),e.R7$(2),e.Y8G("title",null==t.resteAPayer?"Montant restant non d\xe9fini":""),e.R7$(),e.SpI(" ",e.i5U(17,16,t.resteAPayer??0,i.getDeviseSymbol(t.deviseId))," "),e.R7$(2),e.Y8G("ngIf",null==t.resteAPayer),e.R7$(2),e.Y8G("ngIf","regle"===i.getStatusLabel(t.status)),e.R7$(),e.Y8G("ngIf","non_regle"===i.getStatusLabel(t.status)),e.R7$(),e.Y8G("ngIf","other"===i.getStatusLabel(t.status))}}function B(s,a){1&s&&(e.j41(0,"tr")(1,"td",34),e.EFF(2,"Aucune facture trouv\xe9e"),e.k0s()())}function V(s,a){if(1&s&&(e.j41(0,"div",15)(1,"table",16)(2,"thead")(3,"tr")(4,"th"),e.EFF(5,"Id"),e.k0s(),e.j41(6,"th"),e.EFF(7,"Date"),e.k0s(),e.j41(8,"th"),e.EFF(9,"Client"),e.k0s(),e.j41(10,"th"),e.EFF(11,"Total"),e.k0s(),e.j41(12,"th"),e.EFF(13,"D\xe9tails"),e.k0s(),e.j41(14,"th"),e.EFF(15,"Montant Restant"),e.k0s(),e.j41(16,"th"),e.EFF(17,"Statut"),e.k0s(),e.j41(18,"th"),e.EFF(19,"Actions"),e.k0s()()(),e.j41(20,"tbody"),e.Z7z(21,X,30,19,"tr",null,_),e.nVh(23,B,3,0,"tr"),e.k0s()()()),2&s){const t=e.XpG();e.R7$(21),e.Dyx(t.factures),e.R7$(2),e.vxM(0===t.factures.length?23:-1)}}let O=(()=>{class s{constructor(t,i,n,o,r,l){this.factureService=t,this.clientService=i,this.produitService=n,this.deviseService=o,this.reglementService=r,this.modalService=l,this.factures=[],this.clients=[],this.produits=[],this.devises=[],this.reglements=[],this.selectedClientId=null,this.isDataLoaded=!1}ngOnInit(){this.loadData()}loadData(){(0,j.p)({factures:this.factureService.getAllFactures(),clients:this.clientService.getAllClients(),produits:this.produitService.getProduits(),devises:this.deviseService.getAllDevises(),reglements:this.reglementService.getAllReglements()}).subscribe({next:({factures:t,clients:i,produits:n,devises:o,reglements:r})=>{console.log("Raw factures from backend:",t.map(l=>({id:l.id,total:l.total,montantRestant:l.montantRestant,status:l.status,deviseId:l.deviseId}))),this.factures=t.map(l=>{const m={...l,montantRestant:void 0!==l.montantRestant?l.montantRestant:this.calculateMontantRestant(l.id,r)};return console.log("Mapped facture:",{id:m.id,total:m.total,montantRestant:m.montantRestant,status:m.status,deviseId:m.deviseId}),m}),this.clients=i,this.produits=n,this.devises=o,this.reglements=r,this.isDataLoaded=!0,console.log("Factures charg\xe9es:",this.factures.map(l=>({id:l.id,total:l.total,montantRestant:l.resteAPayer,status:l.status,deviseId:l.deviseId}))),console.log("Clients charg\xe9s:",i),console.log("Produits charg\xe9s:",n),console.log("Devises charg\xe9es:",o),console.log("R\xe8glements charg\xe9s:",r)},error:t=>{console.error("Erreur lors du chargement des donn\xe9es:",t),this.isDataLoaded=!0}})}calculateMontantRestant(t,i){if(!t)return 0;const n=i.filter(r=>r.factureId===t).reduce((r,l)=>r+l.montant,0),o=this.factures.find(r=>r.id===t);return void 0!==o?.resteAPayer?o.resteAPayer:o?.total||0-n}filterByClient(){this.selectedClientId?this.factureService.getFacturesByClient(this.selectedClientId).subscribe({next:t=>{this.factures=t.map(i=>({...i,montantRestant:i.resteAPayer??this.calculateMontantRestant(i.id,this.reglements)}))},error:t=>{console.error("Erreur lors du filtrage par client:",t)}}):this.loadData()}openAddModal(){if(!this.isDataLoaded)return void console.warn("Donn\xe9es non charg\xe9es, impossible d'ouvrir la modale");const t=this.modalService.open(F,{size:"lg"});t.componentInstance.facture={dateFacture:new Date,clientID:0,factureLignes:[],status:g.P.NON_REGLE,total:0,deviseId:this.devises.length>0?this.devises[0].id:0},t.componentInstance.clients=[...this.clients],t.componentInstance.produits=[...this.produits],t.componentInstance.devises=[...this.devises],t.result.then(i=>{i&&this.factureService.createFacture(i).subscribe({next:()=>this.loadData(),error:n=>console.error("Erreur cr\xe9ation de facture:",n)})}).catch(()=>{})}openEditModal(t){if(!this.isDataLoaded)return void console.warn("Donn\xe9es non charg\xe9es, impossible d'ouvrir la modale");const i=this.modalService.open(F,{size:"lg"}),n={...t,dateFacture:new Date(t.dateFacture),factureLignes:t.factureLignes.map(o=>({...o,produit:o.produit?{...o.produit}:void 0}))};i.componentInstance.facture=n,i.componentInstance.clients=[...this.clients],i.componentInstance.produits=[...this.produits],i.componentInstance.devises=[...this.devises],i.componentInstance.isEdit=!0,i.result.then(o=>{o?.id&&this.factureService.updateFacture(o.id,o).subscribe({next:()=>this.loadData(),error:r=>console.error("Erreur mise \xe0 jour de facture:",r)})}).catch(()=>{})}openAddReglementModal(t){if(!this.isDataLoaded)return void console.warn("Donn\xe9es non charg\xe9es, impossible d'ouvrir la modale");const i=this.modalService.open(R.r,{size:"lg"});i.componentInstance.reglement={montant:0,dateReglement:(new Date).toISOString(),factureId:t.id,modePaiement:v.j.CASH,deviseId:t.deviseId},i.componentInstance.factures=[t],i.componentInstance.devises=[...this.devises],i.componentInstance.isEdit=!1,i.result.then(n=>{n&&this.reglementService.createReglement(n).subscribe({next:()=>this.loadData(),error:o=>console.error("Erreur cr\xe9ation de r\xe8glement:",o)})}).catch(()=>{})}confirmDelete(t){confirm("\xcates-vous s\xfbr de vouloir supprimer cette facture ?")&&this.factureService.deleteFacture(t).subscribe({next:()=>this.loadData(),error:i=>console.error("Erreur lors de la suppression:",i)})}getProduitPrice(t){return this.produits.find(n=>n.id===t)?.price||0}getDeviseSymbol(t){const i=this.devises.find(n=>n.id===t);return i?i.symbole:"TND"}getStatusLabel(t){if(!t)return"other";switch(t){case g.P.REGLE:return"regle";case g.P.NON_REGLE:return"non_regle";default:return"other"}}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(M.Q),e.rXU(k.X),e.rXU(L.D),e.rXU(S.c),e.rXU(T.r),e.rXU(h.Bq))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-facture"]],decls:14,vars:7,consts:[[1,"row"],[1,"col-xl-12"],["cardTitle","Liste des Factures","blockClass","table-border-style",3,"options"],[1,"mb-3"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fa","fa-plus"],[1,"float-end"],[1,"form-select",2,"width","250px",3,"ngModelChange","change","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"text-center"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[1,"table-responsive"],[1,"table","table-striped"],["scope","row"],[1,"list-unstyled"],[3,"title"],["style","color: red;",4,"ngIf"],["class","badge m-r-5 badge-pill bg-success",4,"ngIf"],["class","badge m-r-5 badge-pill bg-danger",4,"ngIf"],["class","badge m-r-5 badge-pill bg-secondary",4,"ngIf"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"fa","fa-edit"],[1,"btn","btn-sm","btn-outline-success","me-2",3,"click"],[1,"fa","fa-money-bill"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"fa","fa-trash"],[2,"color","red"],[1,"badge","m-r-5","badge-pill","bg-success"],[1,"badge","m-r-5","badge-pill","bg-danger"],[1,"badge","m-r-5","badge-pill","bg-secondary"],["colspan","8",1,"text-center"]],template:function(i,n){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"app-card",2)(3,"div",3)(4,"button",4),e.bIt("click",function(){return n.openAddModal()}),e.nrm(5,"i",5),e.EFF(6," Cr\xe9er une facture "),e.k0s(),e.j41(7,"div",6)(8,"select",7),e.mxI("ngModelChange",function(r){return e.DH7(n.selectedClientId,r)||(n.selectedClientId=r),r}),e.bIt("change",function(){return n.filterByClient()}),e.j41(9,"option",8),e.EFF(10,"Tous les clients"),e.k0s(),e.DNE(11,A,2,2,"option",9),e.k0s()()(),e.DNE(12,$,6,0,"div",10)(13,V,24,1,"div",11),e.k0s()()()),2&i&&(e.R7$(2),e.Y8G("options",!1),e.R7$(2),e.Y8G("disabled",!n.isDataLoaded),e.R7$(4),e.R50("ngModel",n.selectedClientId),e.R7$(),e.Y8G("value",null),e.R7$(2),e.Y8G("ngForOf",n.clients),e.R7$(),e.Y8G("ngIf",!n.isDataLoaded),e.R7$(),e.Y8G("ngIf",n.isDataLoaded))},dependencies:[p.MD,p.Sq,p.bT,p.oe,p.vh,d.YN,d.xH,d.y7,d.wz,d.BC,d.vS,b.i],encapsulation:2})}}return s})()}}]);